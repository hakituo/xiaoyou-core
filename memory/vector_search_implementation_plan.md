# 向量搜索功能实现计划

## 技术选型

### 1. 向量嵌入模型
- 使用 `sentence-transformers` 作为主要的嵌入模型库
- 选择 `paraphrase-multilingual-MiniLM-L12-v2` 模型，支持中文和英文
- 备选模型：`text2vec-base-chinese`（专为中文优化）

### 2. 向量存储
- 短期实现：使用内存中的 numpy 数组存储向量
- 长期实现：考虑集成轻量级向量数据库如 FAISS 或 Milvus Lite

### 3. 相似度计算
- 使用余弦相似度计算文本向量间的相似性
- 实现 Top-K 相似结果检索

## 实现步骤

### 阶段一：基础设置与依赖
1. 更新 requirements.txt 添加必要依赖
2. 创建向量嵌入生成模块
3. 实现基础的向量相似度计算功能

### 阶段二：集成到记忆系统
1. 修改 MemoryManager 添加向量字段
2. 实现记忆创建时的向量生成
3. 添加向量搜索方法
4. 更新搜索接口支持语义搜索

### 阶段三：权重系统整合
1. 更新 WeightedMemoryManager 支持向量搜索
2. 整合权重计算与向量相似度
3. 实现基于向量相似度的记忆权重调整

### 阶段四：测试与优化
1. 编写单元测试
2. 性能优化
3. 内存使用优化

## 具体实现要点

### 1. 向量嵌入模块
- 创建 `embedding_generator.py` 模块
- 实现嵌入模型的懒加载
- 提供批量嵌入生成功能

### 2. MemoryManager 修改
- 扩展记忆数据结构，添加 `embedding` 字段
- 实现 `search_by_similarity` 方法
- 支持混合搜索（关键词+向量相似度）

### 3. 数据持久化
- 将向量以 base64 编码的方式保存到 JSON 或 SQLite
- 实现向量的序列化和反序列化

### 4. 兼容性考虑
- 确保与现有权重系统兼容
- 支持旧数据的向量生成（回溯处理）
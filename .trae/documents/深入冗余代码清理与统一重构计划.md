## 清理目标与范围
- 范围：当前工作目录的所有业务代码与脚本，排除 `mvp/`、`paper/`、`venv*/`、`node_modules/`、二进制与第三方依赖目录。
- 目标：系统化清除未使用代码与临时代码，统一日志与错误处理，减少重复逻辑与空实现，同时确保功能不变与可追溯。

## 检测工具与规则
- Python
  - `ruff`：`F401` 未使用导入、`F841` 未使用变量、`E/F/W` 通用错误/警告、`PLC/PLE` 类型问题；开启 `RUF100` 自动修复优先项。
  - `vulture`：检测未引用的函数、类与变量，设置合理阈值（≥90）。
  - `autoflake`：安全移除未使用导入与变量，`--remove-all-unused-imports --ignore-init-module-imports`。
  - `flake8`/`pylint`（可选）：`R0801` 重复代码块提示，`C` 类风格提示用于模块化拆分参考。
- TypeScript/前端
  - `eslint` + `@typescript-eslint`：`no-unused-vars`、`no-duplicate-imports`、`no-useless-return`、`no-empty`、`no-console`（保留 logger 例外）。
  - `tsc --noEmit --noUnusedLocals --noUnusedParameters`：类型层面定位未使用实体。
- C++（可选）
  - `clang-tidy`：`modernize-use-nullptr`、`readability-*`、`misc-unused-parameters` 与 `bugprone-*`。

## 清理策略与步骤
1. 预扫描与基线报告
   - 运行上述工具生成初始问题清单与指标（各目录分别输出）。
   - 标记“安全自动修复”与“需人工确认”的问题分组。
2. 自动化安全清理
   - Python：`autoflake` 移除未使用导入/变量；`ruff --fix` 处理可自动修复项。
   - 前端：`eslint --fix`，替换残留 `console.*` 为统一 `logger`（保留 node 环境脚本与必要诊断例外）。
3. 人工确认与精修
   - 删除真正未引用的函数/类（`vulture` 交叉验证），保留接口占位与向后兼容的适配层。
   - 合并/抽取重复逻辑为公共工具函数或模块。
   - 移除空函数与废弃注释、调试代码块（如 `if __name__ == "__main__"` 下的临时逻辑）。
   - 统一错误处理与日志写法（后端用 `core.utils.logger`，前端用 `src/utils/logger.ts`）。
4. 模块化重构（必要时）
   - 拆分巨型函数与文件，建立清晰接口；示例：`core/websocket_manager.py:488` 的心跳检查器按职责拆分；
   - 统一数据结构与工具方法，减少复制粘贴代码。
5. 验证与一致性
   - Python：`python -m py_compile` 全量编译；运行现有单元测试与新增最小用例。
   - 前端：`tsc --noEmit` 类型检查与 `npm run lint`；本地构建验证。
   - C++：可选执行 `clang-tidy` 与编译测试（若已配置）。
6. 报告与变更追溯
   - 生成优化报告：问题清单、清理项、保留项、重构决策与度量（删除/重构的行数、重复代码减少比例）。
   - 导出关键文件的修改前后 diff 片段；按模块分节，确保版本控制可追溯。

## 保留与删除判定规则
- 保留（不删除）：
  - 接口占位、向后兼容适配器、错误处理与回退逻辑的空实现（例如 `core/utils/logger.py:22` 的脱敏初始化占位）。
  - 仍在文档或配置引用的入口与钩子；实验与基准测试脚本但需加注释标识。
- 删除：
  - 未被引用且非公共 API 的函数/类/变量（`vulture` 与全局检索确认）。
  - 重复的私有逻辑代码块（抽取公共方法后删除原重复块）。
  - 临时调试代码与无效注释、空函数体、无用的 `print/console`（统一用 logger）。
  - 可执行入口中的内联测试逻辑（如 `core/env/websocket_client.py:449` 的直接运行调用，迁移到独立测试用例）。

## 具体候选与示例
- 后端
  - `core/websocket_manager.py:488` 心跳检查与消息处理路径存在职责较多，建议拆分并合并公共发送/统计逻辑。
  - `core/utils/logger.py:22-23` 为回退占位函数，标注保留，避免误删。
- 前端
  - `frontend/Aveline_UI/src` 逐项清理 `console.*` 残留、未使用导入/变量、重复工具函数；统一通过 `logger`。

## 测试与保障
- 为每个删除/重构点补充最小测试：
  - Python：针对编解码与接口行为（示例：`WebSocketMessage.from_dict/to_dict` 已有样例）。
  - 前端：组件交互与 API 调用路径的行为测试，至少覆盖重试与错误日志分支。
- 验证“前后功能一致”：比对 API 返回、核心业务流程日志与关键性能指标。

## 交付物
- 优化报告（问题清单、处理策略、度量指标）。
- 修改前后代码对比（按模块汇总）。
- 工具配置与命令列表（可复用）。
- 提交信息模板，保证版本控制可追溯。

## 执行计划
1. 运行检测工具并生成基线报告。
2. 自动化安全修复；提交一次。
3. 人工确认与精修、抽取公共逻辑；提交一次。
4. 运行全量验证与测试；提交一次并生成最终报告。

请确认以上计划，确认后我将按步骤开始检测、清理与重构，同时生成报告与代码对比。